\hypertarget{classrtl_1_1copy__on__write}{}\doxysection{rtl\+::copy\+\_\+on\+\_\+write$<$ T $>$ Class Template Reference}
\label{classrtl_1_1copy__on__write}\index{rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}}


A template class that allows clients to use copy-\/on-\/write. Use \mbox{\hyperlink{classrtl_1_1copy__on__write_a1339e528bc8c3e57e8026e6938d01ed1}{copy()}} to create your own copy.  




{\ttfamily \#include $<$copy\+\_\+on\+\_\+write.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_af243f92a91af37f42ae8ceea4e7d31ce}\label{classrtl_1_1copy__on__write_af243f92a91af37f42ae8ceea4e7d31ce}} 
{\bfseries copy\+\_\+on\+\_\+write} (\mbox{\hyperlink{classrtl_1_1copy__on__write}{copy\+\_\+on\+\_\+write}} \&other)
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a2df278c0b42c3a8a0bffddbdeb80cfc2}\label{classrtl_1_1copy__on__write_a2df278c0b42c3a8a0bffddbdeb80cfc2}} 
\mbox{\hyperlink{classrtl_1_1copy__on__write}{copy\+\_\+on\+\_\+write}} \& {\bfseries operator=} (\mbox{\hyperlink{classrtl_1_1copy__on__write}{copy\+\_\+on\+\_\+write}} \&other)
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_ae5a3b8243b2f4483a8780f21dccd765e}\label{classrtl_1_1copy__on__write_ae5a3b8243b2f4483a8780f21dccd765e}} 
const T $\ast$ \mbox{\hyperlink{classrtl_1_1copy__on__write_ae5a3b8243b2f4483a8780f21dccd765e}{at}} (size\+\_\+t where)
\begin{DoxyCompactList}\small\item\em data\mbox{[}where\mbox{]} without copy \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a3614038ea84664906b8198d73d63be82}\label{classrtl_1_1copy__on__write_a3614038ea84664906b8198d73d63be82}} 
T $\ast$ \mbox{\hyperlink{classrtl_1_1copy__on__write_a3614038ea84664906b8198d73d63be82}{at\+\_\+c}} (size\+\_\+t where)
\begin{DoxyCompactList}\small\item\em data\mbox{[}where\mbox{]} with copy \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a37fe5cdbc7db77c6849a0000a99dd764}\label{classrtl_1_1copy__on__write_a37fe5cdbc7db77c6849a0000a99dd764}} 
uint32\+\_\+t \mbox{\hyperlink{classrtl_1_1copy__on__write_a37fe5cdbc7db77c6849a0000a99dd764}{get\+\_\+alloc\+\_\+size}} () const
\begin{DoxyCompactList}\small\item\em How many bytes are allocated? \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_af880073bf0fb164bd5d789b708e290d4}\label{classrtl_1_1copy__on__write_af880073bf0fb164bd5d789b708e290d4}} 
uint32\+\_\+t \mbox{\hyperlink{classrtl_1_1copy__on__write_af880073bf0fb164bd5d789b708e290d4}{get\+\_\+size}} () const
\begin{DoxyCompactList}\small\item\em size of data section \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a52866ecfaab2d48c4055ef4bf3992058}\label{classrtl_1_1copy__on__write_a52866ecfaab2d48c4055ef4bf3992058}} 
uint32\+\_\+t \mbox{\hyperlink{classrtl_1_1copy__on__write_a52866ecfaab2d48c4055ef4bf3992058}{get\+\_\+num\+\_\+data}} () const
\begin{DoxyCompactList}\small\item\em How many individual T\textquotesingle{}s can fit in the data section This is generally what you will want to use. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a1339e528bc8c3e57e8026e6938d01ed1}\label{classrtl_1_1copy__on__write_a1339e528bc8c3e57e8026e6938d01ed1}} 
T $\ast$ \mbox{\hyperlink{classrtl_1_1copy__on__write_a1339e528bc8c3e57e8026e6938d01ed1}{copy}} ()
\begin{DoxyCompactList}\small\item\em Get your own copy. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_ae163f0887ebbb117dd957448eeab8be9}\label{classrtl_1_1copy__on__write_ae163f0887ebbb117dd957448eeab8be9}} 
const T $\ast$ \mbox{\hyperlink{classrtl_1_1copy__on__write_ae163f0887ebbb117dd957448eeab8be9}{reference}} () const
\begin{DoxyCompactList}\small\item\em Obtain a const reference to the data. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classrtl_1_1copy__on__write_a8d581cba2441eeec164a63f5ad81fb9c}{resize}} (size\+\_\+t n)
\begin{DoxyCompactList}\small\item\em Resize the buffer to (n $\ast$ T) + DATA\+\_\+\+SECTION\+\_\+\+OFFSET bytes Will create a new copy. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a2ed2c715a87394ac108e1a6d0c5cd8c4}\label{classrtl_1_1copy__on__write_a2ed2c715a87394ac108e1a6d0c5cd8c4}} 
void \mbox{\hyperlink{classrtl_1_1copy__on__write_a2ed2c715a87394ac108e1a6d0c5cd8c4}{memcpy}} (const T $\ast$source, size\+\_\+t n)
\begin{DoxyCompactList}\small\item\em Copy to the {\itshape data section offset} \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_ad3dd30e446c8fdbf7a85987e55b5cccc}\label{classrtl_1_1copy__on__write_ad3dd30e446c8fdbf7a85987e55b5cccc}} 
void \mbox{\hyperlink{classrtl_1_1copy__on__write_ad3dd30e446c8fdbf7a85987e55b5cccc}{memcpy}} (const T $\ast$source, size\+\_\+t n, size\+\_\+t offset)
\begin{DoxyCompactList}\small\item\em Copy to the data section + offset Note that this will copy relative to the offset. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a0d35ac604ce08e3dcf2431353358e110}\label{classrtl_1_1copy__on__write_a0d35ac604ce08e3dcf2431353358e110}} 
FORCEINLINE uint32\+\_\+t {\bfseries get\+\_\+reference\+\_\+count} () const
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_aa008ef0dadfa294fa199e810c6075bdb}\label{classrtl_1_1copy__on__write_aa008ef0dadfa294fa199e810c6075bdb}} 
FORCEINLINE uint32\+\_\+t {\bfseries get\+\_\+data\+\_\+size} () const
\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a84de492ef9909bb0362b8d3c4537a31f}\label{classrtl_1_1copy__on__write_a84de492ef9909bb0362b8d3c4537a31f}} 
FORCEINLINE T $\ast$ {\bfseries get\+\_\+data} ()
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a5a437df37ef87c826d7adef164682205}\label{classrtl_1_1copy__on__write_a5a437df37ef87c826d7adef164682205}} 
FORCEINLINE uint32\+\_\+t $\ast$ {\bfseries get\+\_\+refc\+\_\+ptr} ()
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a49ba01ae01b8af1b39287135edf71c1c}\label{classrtl_1_1copy__on__write_a49ba01ae01b8af1b39287135edf71c1c}} 
FORCEINLINE uint32\+\_\+t $\ast$ {\bfseries get\+\_\+data\+\_\+size\+\_\+ptr} ()
\item 
uint32\+\_\+t \mbox{\hyperlink{classrtl_1_1copy__on__write_a3f35627a05369714f302dc831c603840}{\+\_\+\+\_\+copy\+\_\+on\+\_\+write}} ()
\begin{DoxyCompactList}\small\item\em Create a copy of the buffer for our own use. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a6f6952fcc5d5102c0a878b23d823891c}\label{classrtl_1_1copy__on__write_a6f6952fcc5d5102c0a878b23d823891c}} 
T $\ast$ {\bfseries m\+\_\+ptr}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a907b299336283d249a8c78f42be4d254}\label{classrtl_1_1copy__on__write_a907b299336283d249a8c78f42be4d254}} 
T $\ast$$\ast$ {\bfseries m\+\_\+data\+Ptr}
\end{DoxyCompactItemize}
\doxysubsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a250a9c9b18dc24a22804f9a8ae5caa28}\label{classrtl_1_1copy__on__write_a250a9c9b18dc24a22804f9a8ae5caa28}} 
static constexpr size\+\_\+t {\bfseries REF\+\_\+\+SECTION\+\_\+\+OFFSET} = 0
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a7fce2d4c761b9e68846d165255c31cdd}\label{classrtl_1_1copy__on__write_a7fce2d4c761b9e68846d165255c31cdd}} 
static constexpr size\+\_\+t {\bfseries DATA\+\_\+\+SIZE\+\_\+\+SECTION\+\_\+\+OFFSET} = REF\+\_\+\+SECTION\+\_\+\+OFFSET + alignof(T) $<$ sizeof(uint32\+\_\+t) ? sizeof(uint32\+\_\+t) \+: 1
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a17425d1e82635e7c6b2a04348983b8ef}\label{classrtl_1_1copy__on__write_a17425d1e82635e7c6b2a04348983b8ef}} 
static constexpr size\+\_\+t {\bfseries DATA\+\_\+\+SECTION\+\_\+\+OFFSET} = DATA\+\_\+\+SIZE\+\_\+\+SECTION\+\_\+\+OFFSET + DATA\+\_\+\+SIZE\+\_\+\+SECTION\+\_\+\+OFFSET
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\subsubsection*{template$<$class T$>$\newline
class rtl\+::copy\+\_\+on\+\_\+write$<$ T $>$}

A template class that allows clients to use copy-\/on-\/write. Use \mbox{\hyperlink{classrtl_1_1copy__on__write_a1339e528bc8c3e57e8026e6938d01ed1}{copy()}} to create your own copy. 

$\ast$$\ast$ inspired by Godot Engine\textquotesingle{}s Cow\+Data $\ast$$\ast$

Provide a Copy on Write buffer for clients

m\+\_\+data\+Ptr holds a pointer to a heap allocated buffer of memory

When the copy constructor or copy assignment operator is used, the pointer to the other COWs buffer is used and it\textquotesingle{}s refcounter incremented

Reference counters are stored inside the allocated buffer 
\begin{DoxyCode}{0}
\DoxyCodeLine{0           32                 64    }
\DoxyCodeLine{┌────────────┬───────────┬──────┐}
\DoxyCodeLine{│  Ref Count │ Data Size │ Data │    }
\DoxyCodeLine{└────────────┴───────────┴──────┘}

\end{DoxyCode}


When a copy occurs\+:
\begin{DoxyEnumerate}
\item Create a new buffer and copy the existing buffer\textquotesingle{}s data into it.
\item Decrement the old buffer\textquotesingle{}s ref count
\item Set the new buffer\textquotesingle{}s ref count to 1
\item Set the current buffer to the new buffer ~\newline

\end{DoxyEnumerate}

Sharing works via pointers-\/to-\/pointers m\+\_\+ptr holds the data m\+\_\+data\+Ptr will either hold the value of OUR m\+\_\+ptr if we own it, or another clients m\+\_\+ptr if we don\textquotesingle{}t.

The function \mbox{\hyperlink{classrtl_1_1copy__on__write_a3f35627a05369714f302dc831c603840}{\+\_\+\+\_\+copy\+\_\+on\+\_\+write}} will ensure that we do own our own copy 

\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a3f35627a05369714f302dc831c603840}\label{classrtl_1_1copy__on__write_a3f35627a05369714f302dc831c603840}} 
\index{rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}!\_\_copy\_on\_write@{\_\_copy\_on\_write}}
\index{\_\_copy\_on\_write@{\_\_copy\_on\_write}!rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{\_\_copy\_on\_write()}{\_\_copy\_on\_write()}}
{\footnotesize\ttfamily template$<$class T $>$ \\
uint32\+\_\+t \mbox{\hyperlink{classrtl_1_1copy__on__write}{rtl\+::copy\+\_\+on\+\_\+write}}$<$ T $>$\+::\+\_\+\+\_\+copy\+\_\+on\+\_\+write\hspace{0.3cm}{\ttfamily [private]}}



Create a copy of the buffer for our own use. 

If this is the owning instance or it has no size, nothing will happen \mbox{\Hypertarget{classrtl_1_1copy__on__write_a8d581cba2441eeec164a63f5ad81fb9c}\label{classrtl_1_1copy__on__write_a8d581cba2441eeec164a63f5ad81fb9c}} 
\index{rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}!resize@{resize}}
\index{resize@{resize}!rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{resize()}{resize()}}
{\footnotesize\ttfamily template$<$class T $>$ \\
void \mbox{\hyperlink{classrtl_1_1copy__on__write}{rtl\+::copy\+\_\+on\+\_\+write}}$<$ T $>$\+::resize (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{n }\end{DoxyParamCaption})}



Resize the buffer to (n $\ast$ T) + DATA\+\_\+\+SECTION\+\_\+\+OFFSET bytes Will create a new copy. 

Resizes the buffer

This will perform a copy-\/on-\/write 

The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
core/rtl/copy\+\_\+on\+\_\+write.\+h\end{DoxyCompactItemize}
