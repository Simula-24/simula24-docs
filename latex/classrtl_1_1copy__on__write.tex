\hypertarget{classrtl_1_1copy__on__write}{}\doxysection{rtl\+::copy\+\_\+on\+\_\+write$<$ T $>$ Class Template Reference}
\label{classrtl_1_1copy__on__write}\index{rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}}


A template class that allows clients to ~\newline
 use copy-\/on-\/write. Use \mbox{\hyperlink{classrtl_1_1copy__on__write_a1053027fbbb6eca5ab9c9550532ae6fc}{copy()}} to create your own copy.  




{\ttfamily \#include $<$copy\+\_\+on\+\_\+write.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a4a066e83e486a0119b10d7744c867b90}\label{classrtl_1_1copy__on__write_a4a066e83e486a0119b10d7744c867b90}} 
{\bfseries copy\+\_\+on\+\_\+write} (const \mbox{\hyperlink{classrtl_1_1copy__on__write}{copy\+\_\+on\+\_\+write}} \&other)
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_aad92d50f4c6b0397bc52e7d23a10782f}\label{classrtl_1_1copy__on__write_aad92d50f4c6b0397bc52e7d23a10782f}} 
{\bfseries copy\+\_\+on\+\_\+write} (const \mbox{\hyperlink{classrtl_1_1copy__on__write}{copy\+\_\+on\+\_\+write}} \&\&other)
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_aa6f809643796da6b760935e96540e75b}\label{classrtl_1_1copy__on__write_aa6f809643796da6b760935e96540e75b}} 
\mbox{\hyperlink{classrtl_1_1copy__on__write}{copy\+\_\+on\+\_\+write}} \& {\bfseries operator=} (const \mbox{\hyperlink{classrtl_1_1copy__on__write}{copy\+\_\+on\+\_\+write}} \&other)
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a5082544e2e9d0a357b5a720914bbf240}\label{classrtl_1_1copy__on__write_a5082544e2e9d0a357b5a720914bbf240}} 
\mbox{\hyperlink{classrtl_1_1copy__on__write}{copy\+\_\+on\+\_\+write}} \& {\bfseries operator=} (const \mbox{\hyperlink{classrtl_1_1copy__on__write}{copy\+\_\+on\+\_\+write}} \&\&other)
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a801bf9b3dd2233656fc0bfe5343a35ee}\label{classrtl_1_1copy__on__write_a801bf9b3dd2233656fc0bfe5343a35ee}} 
const T \& \mbox{\hyperlink{classrtl_1_1copy__on__write_a801bf9b3dd2233656fc0bfe5343a35ee}{at}} (size\+\_\+t where) const
\begin{DoxyCompactList}\small\item\em data\mbox{[}where\mbox{]} without copy \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_ac8c06c3eb6b23f241b7d9d23653fe1bc}\label{classrtl_1_1copy__on__write_ac8c06c3eb6b23f241b7d9d23653fe1bc}} 
T \& \mbox{\hyperlink{classrtl_1_1copy__on__write_ac8c06c3eb6b23f241b7d9d23653fe1bc}{at\+\_\+c}} (size\+\_\+t where)
\begin{DoxyCompactList}\small\item\em data\mbox{[}where\mbox{]} with copy \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a1053027fbbb6eca5ab9c9550532ae6fc}\label{classrtl_1_1copy__on__write_a1053027fbbb6eca5ab9c9550532ae6fc}} 
T $\ast$ \mbox{\hyperlink{classrtl_1_1copy__on__write_a1053027fbbb6eca5ab9c9550532ae6fc}{copy}} ()
\begin{DoxyCompactList}\small\item\em Get your own copy. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a926ab509ec076c5cb3ea7ee46cc377ce}\label{classrtl_1_1copy__on__write_a926ab509ec076c5cb3ea7ee46cc377ce}} 
const T $\ast$ \mbox{\hyperlink{classrtl_1_1copy__on__write_a926ab509ec076c5cb3ea7ee46cc377ce}{reference}} () const
\begin{DoxyCompactList}\small\item\em Obtain a const reference to the data. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_af880073bf0fb164bd5d789b708e290d4}\label{classrtl_1_1copy__on__write_af880073bf0fb164bd5d789b708e290d4}} 
uint32\+\_\+t \mbox{\hyperlink{classrtl_1_1copy__on__write_af880073bf0fb164bd5d789b708e290d4}{get\+\_\+size}} () const
\begin{DoxyCompactList}\small\item\em size of data section \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a52866ecfaab2d48c4055ef4bf3992058}\label{classrtl_1_1copy__on__write_a52866ecfaab2d48c4055ef4bf3992058}} 
uint32\+\_\+t \mbox{\hyperlink{classrtl_1_1copy__on__write_a52866ecfaab2d48c4055ef4bf3992058}{get\+\_\+num\+\_\+data}} () const
\begin{DoxyCompactList}\small\item\em How many individual T\textquotesingle{}s can fit in the data section This is generally what you will want to use. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classrtl_1_1copy__on__write_a8d581cba2441eeec164a63f5ad81fb9c}{resize}} (size\+\_\+t n)
\begin{DoxyCompactList}\small\item\em Resize the buffer to (n $\ast$ T) + DATA\+\_\+\+OFFSET bytes Will create a new copy. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a2ed2c715a87394ac108e1a6d0c5cd8c4}\label{classrtl_1_1copy__on__write_a2ed2c715a87394ac108e1a6d0c5cd8c4}} 
void \mbox{\hyperlink{classrtl_1_1copy__on__write_a2ed2c715a87394ac108e1a6d0c5cd8c4}{memcpy}} (const T $\ast$source, size\+\_\+t n)
\begin{DoxyCompactList}\small\item\em Copy to the {\itshape data section offset} \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_ad3dd30e446c8fdbf7a85987e55b5cccc}\label{classrtl_1_1copy__on__write_ad3dd30e446c8fdbf7a85987e55b5cccc}} 
void \mbox{\hyperlink{classrtl_1_1copy__on__write_ad3dd30e446c8fdbf7a85987e55b5cccc}{memcpy}} (const T $\ast$source, size\+\_\+t n, size\+\_\+t offset)
\begin{DoxyCompactList}\small\item\em Copy to the data section + offset Note that this will copy relative to the offset. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a83aefa66df603d6892e65c2fa75053fe}\label{classrtl_1_1copy__on__write_a83aefa66df603d6892e65c2fa75053fe}} 
constexpr uint32\+\_\+t {\bfseries get\+\_\+reference\+\_\+count} () const
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_ad1a60ddb711e6700c429fce3d080cc22}\label{classrtl_1_1copy__on__write_ad1a60ddb711e6700c429fce3d080cc22}} 
constexpr uint32\+\_\+t {\bfseries get\+\_\+data\+\_\+size} () const
\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_af5aa9540ee4413af3323db05a8597b77}\label{classrtl_1_1copy__on__write_af5aa9540ee4413af3323db05a8597b77}} 
constexpr T $\ast$ {\bfseries get\+\_\+data} ()
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a4b74bfc06bc2a34cf2e7edd5cd0014d7}\label{classrtl_1_1copy__on__write_a4b74bfc06bc2a34cf2e7edd5cd0014d7}} 
constexpr const T $\ast$ {\bfseries get\+\_\+data} () const
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_acf8606be240a0d02df03d98e32eedc6e}\label{classrtl_1_1copy__on__write_acf8606be240a0d02df03d98e32eedc6e}} 
constexpr uint32\+\_\+t $\ast$ {\bfseries get\+\_\+refc\+\_\+ptr} ()
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a1dae82cfc3bcc8bad5e873778da0ace9}\label{classrtl_1_1copy__on__write_a1dae82cfc3bcc8bad5e873778da0ace9}} 
constexpr uint32\+\_\+t $\ast$ {\bfseries get\+\_\+data\+\_\+size\+\_\+ptr} ()
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a925bd0bc8eab279c27ff3adb54f6f120}\label{classrtl_1_1copy__on__write_a925bd0bc8eab279c27ff3adb54f6f120}} 
constexpr size\+\_\+t {\bfseries get\+\_\+alloc\+\_\+size} (size\+\_\+t n)
\item 
uint32\+\_\+t \mbox{\hyperlink{classrtl_1_1copy__on__write_a3f35627a05369714f302dc831c603840}{\+\_\+\+\_\+copy\+\_\+on\+\_\+write}} ()
\begin{DoxyCompactList}\small\item\em Create a copy of the buffer for our own use. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_aa2807a7e732cd3788be87c55aacc472a}\label{classrtl_1_1copy__on__write_aa2807a7e732cd3788be87c55aacc472a}} 
void {\bfseries ref} ()
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a5eda9e80ccc9db627cfc483f7b57476c}\label{classrtl_1_1copy__on__write_a5eda9e80ccc9db627cfc483f7b57476c}} 
void {\bfseries unref} ()
\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a6f6952fcc5d5102c0a878b23d823891c}\label{classrtl_1_1copy__on__write_a6f6952fcc5d5102c0a878b23d823891c}} 
T $\ast$ {\bfseries m\+\_\+ptr}
\end{DoxyCompactItemize}
\doxysubsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a361904b6679ecfdf2e1556a63687fccc}\label{classrtl_1_1copy__on__write_a361904b6679ecfdf2e1556a63687fccc}} 
static constexpr size\+\_\+t {\bfseries REFCOUNT\+\_\+\+OFFSET} = 0
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_acf2dcf0741ff39af1fec32efe7d74822}\label{classrtl_1_1copy__on__write_acf2dcf0741ff39af1fec32efe7d74822}} 
static constexpr size\+\_\+t {\bfseries SIZE\+\_\+\+OFFSET} = REFCOUNT\+\_\+\+OFFSET + 4
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a69d9e2943927673a579b4a6f0872cb47}\label{classrtl_1_1copy__on__write_a69d9e2943927673a579b4a6f0872cb47}} 
static constexpr size\+\_\+t {\bfseries DATA\+\_\+\+OFFSET} = SIZE\+\_\+\+OFFSET + 4
\end{DoxyCompactItemize}
\doxysubsection*{Friends}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a6769caf572605b0788f7e59333bb5e5a}\label{classrtl_1_1copy__on__write_a6769caf572605b0788f7e59333bb5e5a}} 
{\footnotesize template$<$class U $>$ }\\class {\bfseries array}
\item 
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a7c36d7df0b30208105f56b2e0084e4b5}\label{classrtl_1_1copy__on__write_a7c36d7df0b30208105f56b2e0084e4b5}} 
{\footnotesize template$<$class U $>$ }\\class {\bfseries basic\+\_\+string}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\subsubsection*{template$<$class T$>$\newline
class rtl\+::copy\+\_\+on\+\_\+write$<$ T $>$}

A template class that allows clients to ~\newline
 use copy-\/on-\/write. Use \mbox{\hyperlink{classrtl_1_1copy__on__write_a1053027fbbb6eca5ab9c9550532ae6fc}{copy()}} to create your own copy. 

$\ast$$\ast$ inspired by Godot Engine\textquotesingle{}s Cow\+Data $\ast$$\ast$

Provide a Copy on Write buffer for clients

When the copy constructor or copy assignment operator is used, the pointer to the other COWs buffer is used and it\textquotesingle{}s refcounter incremented

Reference counters are stored inside the allocated buffer 
\begin{DoxyCode}{0}
\DoxyCodeLine{0           32                 64    }
\DoxyCodeLine{┌────────────┬───────────┬──────┐}
\DoxyCodeLine{│  Ref Count │ Data Size │ Data │    }
\DoxyCodeLine{└────────────┴───────────┴──────┘}

\end{DoxyCode}


When a copy occurs\+:
\begin{DoxyEnumerate}
\item Create a new buffer and copy the existing buffer\textquotesingle{}s data into it.
\item Decrement the old buffer\textquotesingle{}s ref count
\item Set the new buffer\textquotesingle{}s ref count to 1
\item Set the current buffer to the new buffer ~\newline

\end{DoxyEnumerate}

The function \mbox{\hyperlink{classrtl_1_1copy__on__write_a3f35627a05369714f302dc831c603840}{\+\_\+\+\_\+copy\+\_\+on\+\_\+write}} will ensure that we do own our own copy 

\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classrtl_1_1copy__on__write_a3f35627a05369714f302dc831c603840}\label{classrtl_1_1copy__on__write_a3f35627a05369714f302dc831c603840}} 
\index{rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}!\_\_copy\_on\_write@{\_\_copy\_on\_write}}
\index{\_\_copy\_on\_write@{\_\_copy\_on\_write}!rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{\_\_copy\_on\_write()}{\_\_copy\_on\_write()}}
{\footnotesize\ttfamily template$<$class T $>$ \\
uint32\+\_\+t \mbox{\hyperlink{classrtl_1_1copy__on__write}{rtl\+::copy\+\_\+on\+\_\+write}}$<$ T $>$\+::\+\_\+\+\_\+copy\+\_\+on\+\_\+write\hspace{0.3cm}{\ttfamily [private]}}



Create a copy of the buffer for our own use. 

If this is the owning instance or it has no size, nothing will happen \mbox{\Hypertarget{classrtl_1_1copy__on__write_a8d581cba2441eeec164a63f5ad81fb9c}\label{classrtl_1_1copy__on__write_a8d581cba2441eeec164a63f5ad81fb9c}} 
\index{rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}!resize@{resize}}
\index{resize@{resize}!rtl::copy\_on\_write$<$ T $>$@{rtl::copy\_on\_write$<$ T $>$}}
\doxysubsubsection{\texorpdfstring{resize()}{resize()}}
{\footnotesize\ttfamily template$<$class T $>$ \\
void \mbox{\hyperlink{classrtl_1_1copy__on__write}{rtl\+::copy\+\_\+on\+\_\+write}}$<$ T $>$\+::resize (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{n }\end{DoxyParamCaption})}



Resize the buffer to (n $\ast$ T) + DATA\+\_\+\+OFFSET bytes Will create a new copy. 

Resizes the buffer

This will perform a copy-\/on-\/write 

The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
core/rtl/copy\+\_\+on\+\_\+write.\+h\end{DoxyCompactItemize}
